# Reflec-Ts Example

A small set of TypeScript files along with a [reflection metadata module](./src/generated/reflect-info.ts) which contains all information about classes and interfaces. This module has been generated by a source code post-processor that I'm working on (code-named "reflec-ts", for now), that uses the compiler API to extract metadata and save it according to the [rbucton's proposal](https://gist.github.com/rbuckton/f6ee6fcdcc21d44fdfa0).

The aim of this github space is to discuss with the TypeScript dev team and the community about the functioning and the API of this forthcoming new project, currently in a prototyping stage.

## Current status

Reflec-ts at the moment can detect and serialize almost all kind of information about classes and interface. Currently it lacks of support for enumerations and type aliases, but these details will be implemented soon.
The decision to output a single file for all metadata comes from the need of cross-referencing types. For example, if you declare an interface in module "A" and implement it in some classes of module "B" and "C", you will notice that they are referencing the **same** interface, since there will be *strict equality* when evaluating the `implements` member of these `ClassType` objects. The same rule applies for generics: when a class declares a generic type "T", all the members (methods, fields) that use it will reference exactly the same `TypeParameter` object; this is the reason why you'll find some temporary variables in reflect-info.ts, namely [\_t](./src/generated/reflect-info.ts#L2) (that stands for tempType) and [\_l](./src/generated/reflect-info.ts#L49) (that stands for localType).

## Open points TBD

* Compiler code coupling. In order to emit reflection data at compilation time I had to add just one line in program.ts, [here](https://github.com/Microsoft/TypeScript/blob/v1.6.2/src/compiler/program.ts#L560). This is necessary since there's no way to embed a pre/post-processor with configuration.
* No link between [getConstructor()](./lib/types.d.ts#L244) and the actual constructor function. In order to achieve this, the code in emitter.ts (maybe here) should emit some code that imports and calls a function in reflect-info.ts, passing the actual constructor function and some kind of "reference" in order to match it with the already serialized reflection data.
* No link between constructor function and reflection data. This could be achieved with reflection metadata API, again by emitting some code that calls reflect-info.ts to get a reference to the serialized type.
* I'm not so satisfied with the current way of "packaging" serialized types. Now reflec-ts follows the directory structure when building reflection data modules (so you have the 'src' and 'lib' object as root containers). For namespace-based project this is useless, but when using modules, there must be some way to identify which classes are in which module.
* others... I would be happy to have some feedback from dev team and other people from community. Feel free to open issues to discuss specific topics.
